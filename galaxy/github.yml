---
- hosts: galaxy
  vars_files:
    - vars/defaults.yml
    - private/galaxy.yml
  tasks:
    - name: Create the galaxy user account
      user:
        name: galaxy
        system: yes
        createhome: yes
        state: present
        shell: /bin/bash

    - name: Clone the Galaxy repository
      git:
        repo: "{{ item.repo }}"
        dest: "{{ item.home }}"
        version: "{{ item.branch }}"
      loop:
        - "{{ galaxy }}"
        - "{{ mods }}"
#        - home: "{{ galaxy_home }}"
#          branch: "{{ galaxy_branch }}"
#          repo: "{{ galaxy_repo }}"
#        - home: "{{ mods_home }}"
#          branch: "{{ mods_branch }}"
#          repo: "{{ mods_repo }}"
    - name: Configure the galaxy.yml file
      template:
        src: templates/galaxy.ini.j2
        dest: "{{ galaxy.home }}/config/galaxy.ini"
    - name: Make sure the Galaxy user owns its directories
      file:
        path: "{{ item }}"
        owner: "{{ galaxy.user }}"
        group: "{{ galaxy.user }}"
        recurse: yes
      loop:
        - "{{ galaxy.home }}"
        - "{{ mods.home }}"